---
title: "Phonotactic knowledge in speakers with a very small active vocabulary"
editor_options:
  chunk_output_type: console
date: '`r Sys.time()`'
output:
  html_document:
    code_folding: hide
    fig_caption: yes
    highlight: textmate
    number_sections: yes
    self_contained: yes
    mode: selfcontained
    theme: flatly
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
  word_document: default
subtitle: Participant filtering, statistical analysis, plots and tables
---

---

```{r setup, echo=F, message=F, warning=FALSE}
library(ggplot2)
library(lme4)
library(lmerTest)
library(ndl)
library(effects)
library(plyr)
library(dplyr)
library(tidyr)
library(knitr)
library(xtable)
library(egg)
library(ordinal)
library(stringr)
library(tidyverse)
library(MASS)
library(kableExtra)
```

<style>
caption, .caption {
color: black;
font-size: 90%;
text-align: left}
a[hreflang]:before{}
</style>

```{r local_functions, echo=FALSE}
# Local functions
# A function to center variables
c. <- function (x) scale(x, scale = FALSE)

# Custom function to format ordinal regression results in a nice table
clm_table <- function(mod, digits=3, ...) {
  table <- summary(mod)$coefficients %>%
    data.frame() %>%
    rlang::set_names(c("beta", "se", "z", "p")) %>%
    rownames_to_column("parameter") %>%
    mutate(
      parameter = parameter %>%
        str_replace_all(
          ., 
          str_c("(", str_c(names(attr(mod$terms, "dataClasses"))[attr(mod$terms, "dataClasses") %in% c("factor", "logical", "character")][-1], collapse="|"), ")"), 
          "\\1 = "
        ) %>%
        str_replace_all(
          .,
          "(?<=^|\\:)(?:c\\.\\()([^:]+)(?:\\))(?=$|\\:)",
          "\\1 (centered)"
        ) %>%
        str_replace_all(., fixed(":"), " &times; "),
      significance = case_when(
        p < 0.001 ~ "\\*\\*\\*",
        p < 0.01 ~ "\\*\\*",
        p < 0.05 ~ "\\*",
        p < 0.1 ~ ".",
        TRUE ~ ""
      ),
      is_threshold = parameter %in% names(mod$alpha)
    ) %>%
    mutate_at(c("z", "p", "significance"), ~ ifelse(is_threshold, NA, .)) %>%
    arrange(is_threshold) %>%
    mutate(
      type = c("Effects", rep("", n()-sum(is_threshold)-1), "Thresholds", rep("", sum(is_threshold)-1))
    ) %>%
    dplyr::select(type, parameter, beta, se, z, p, significance) %>%
    mutate(
      p = ifelse(p<0.001, "<0.001", format(round(p, 3), nsmall=3))
    ) %>%
    kable(digits=3, escape=F, col.names=c("", "Parameter", "Estimate", "Std. Error", "$z$", "$p$", ""), align="llrrrrl", ...) %>%
    column_spec(1, bold=TRUE) %>%
    kable_styling()
  return(table)
}
options(knitr.kable.NA = '')

# Custom function to compute summary data for an ordinal regression model, to be plotted. The "type" argument specifies whether the data are for a latent variable plot, a distributional plot, or a mean rating plot. 
clm_plotdat = function(mod, focal.predictors, type="latent", response.coding=NULL, ...) {
  # For latent variable plot, draw straight from Effect
  if (type=="latent") {
    latentdat <-
      Effect(focal.predictors, mod, latent=TRUE, ...) %>%
      as.data.frame() %>%
      dplyr::select(-se) %>%
      rename("pred"=fit, "lci"=lower, "uci"=upper)
    return(latentdat)
  }
  
  # Get distributional data (used for both of other plots)
  distdat <-
    Effect(focal.predictors, mod, ...) %>%
    as_tibble() %>%
    dplyr::select(all_of(focal.predictors), matches("^(?:(?:L|U)\\.)?prob")) %>%
    pivot_longer(
      cols = -all_of(focal.predictors),
      names_to = c(".value", "response"),
      names_pattern = "^((?:(?:L|U)\\.)?prob)\\.(.+)$"      
    ) %>%
    rename("pred"=prob, "lci"=L.prob, "uci"=U.prob) %>%
    mutate(
      response = rep_len(mod$y.levels, n())
    )
  if (type=="dist") return(distdat)
  
  if (type=="mean") {
    # Get threshold values
    thresholds = c(-Inf, as.numeric(mod$alpha), Inf)
    
    # Get response coding
    if (is.null(response.coding)) {
      response.coding = 1:(length(mod$y.levels))
      names(response.coding) = mod$y.levels
    }
    
    # Build latent variable data based on distributional data
    # Note: this is a HACK since drawing latent variable data from Effect doesn't account for threshold variability. The confidence intervals assume fixed thresholds, which obscures patterns in variation of the thresholds; CIs are thus not correct (but are better than what would be obtained from direct transformation of the latent variable from Effect)
    
    # Get distribution-based latent variable data, assuming fixed thresholds
    latentdat <- distdat %>%
      group_by_at(focal.predictors) %>%
      summarise(
        pred = qlogis(1-pred[1]) + thresholds[2],
        lci = qlogis(1-uci[1]) + thresholds[2],
        uci = qlogis(uci[length(uci)]) + thresholds[length(thresholds)-1]
      ) %>%
      as.data.frame()    
    
    # Get probabilities for each response option
    meandat <- latentdat
    for (i in 1:length(mod$y.levels)) {
      meandat[, paste0("(", mod$y.levels[i], ").prob")] = plogis(latentdat[, "pred"] - thresholds[i]) - plogis(latentdat[, "pred"] - thresholds[i+1])
      meandat[, paste0("(", mod$y.levels[i], ").lci")] = plogis(latentdat[, "lci"] - thresholds[i]) - plogis(latentdat[, "lci"] - thresholds[i+1])
      meandat[, paste0("(", mod$y.levels[i], ").uci")] = plogis(latentdat[, "uci"] - thresholds[i]) - plogis(latentdat[, "uci"] - thresholds[i+1])
    }
    meandat <- meandat %>%
      dplyr::select(-pred, -uci, -lci) %>%
      pivot_longer(
        cols = -all_of(focal.predictors),
        names_to = c("response", ".value"),
        names_pattern = "^\\((.+)\\)\\.([^.]+)$"
      ) %>%
      left_join(
        data.frame(response=names(response.coding), code=response.coding, stringsAsFactors=FALSE),
        by = "response"
      ) %>%
      group_by_at(focal.predictors) %>%
      summarise(
        pred = sum(prob * code),
        lci = sum(lci * code),
        uci = sum(uci * code)
      ) %>%
      ungroup()
    return(meandat)
  }
}

# A function to display multiple plots
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)
  
  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)
  
  numPlots = length(plots)
  
  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}

# Custom function to get the information about thresholds, in a nice format for plotting
clm_thresholds = function(mod) {
  thresholds <- summary(mod)$coefficients %>%
    as.data.frame() %>%
    rownames_to_column() %>%
    dplyr::select(1:3) %>%
    set_names(c("label", "value", "se")) %>%
    filter(label %in% names(mod$alpha)) %>%
    mutate(
      lci = value - 1.96*se,
      uci = value + 1.96*se
    ) %>%
    dplyr::select(-se)
  return(thresholds)
}

# Custom function to format logistic regression results in a nice table
logistic_table <- function(mod, digits=3, ...) {
  table <- summary(mod)$coefficients %>%
    data.frame() %>%
    rlang::set_names(c("beta", "se", "z", "p")) %>%
    rownames_to_column("parameter") %>%
    mutate(
      parameter = parameter %>%
        str_replace_all(
          ., 
          str_c("(", str_c(names(attr(attr(mod@frame, "terms"), "dataClasses"))[attr(attr(mod@frame, "terms"), "dataClasses") %in% c("factor", "logical")][-1], collapse="|"), ")"), 
          "\\1 = "
        ) %>%
        str_replace_all(
          .,
          "(?<=^|\\:)(?:c\\.\\()([^:]+)(?:\\))(?=$|\\:)",
          "\\1 (centered)"
        ) %>%
        str_replace_all(., fixed(":"), " &times; "),
      significance = case_when(
        p < 0.001 ~ "\\*\\*\\*",
        p < 0.01 ~ "\\*\\*",
        p < 0.05 ~ "\\*",
        p < 0.1 ~ ".",
        TRUE ~ ""
      )
    ) %>%
    dplyr::select(parameter, beta, se, z, p, significance) %>%
    mutate(
      p = ifelse(p<0.001, "<0.001", format(round(p, 3), nsmall=3))
    ) %>%
    kable(digits=3, escape=F, col.names=c("Parameter", "Estimate", "Std. Error", "$z$", "$p$", ""), align="lrrrrl", ...) %>%
    kable_styling()
  return(table)
}

```

# Introduction 
This R Markdown script contains all the code used for outlier detection, data analysis and plotting; including additional statistical analyses and all the statistical models with summaries.

# Experiment 1
## Participant exclusions
```{r loading_data_Exp1, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the data to filter out participants
dataExp1 <- read.delim("./dataAnonNotFilteredExp1_added.txt", sep ="\t", header = TRUE, encoding="UTF-8")

# Remove 11 suspicious participants
rmParticipant1Exp1 <- c("5970a90e","6e5ccd20","9e75832a","86687167","64afd2cc","429604bc","409f2599","d6390ddc","7ab6a320","bd90455b","39b29c2b")
dataExp1 <- dataExp1[!dataExp1$workerId %in% rmParticipant1Exp1,]

# Calculate dprime
# Get the hit rate: 4 or 5 to real words
dataExp1$accReal <- ifelse(dataExp1$type=="real" & dataExp1$enteredResponse %in% c(4,5),1,0)
hrateT <- aggregate(accReal ~ workerId, sum, data=dataExp1)
hrateT$hit_rate <- round(hrateT$accReal/132,3)

# Manually correct the hit rate of one participant (who did one less item)
#length(which(dataExp1$type=="real" & dataExp1$workerId=="c0999383"))
hrateT[hrateT$workerId=="c0999383",]$hit_rate <- round(hrateT[hrateT$workerId=="c0999383",]$accReal/131,3)

# Get the FA (false alarm) rate: 4-5 to nonwords
dataExp1$accNon <- ifelse(dataExp1$type=="non" & dataExp1$enteredResponse %in% c(4,5),1,0)
farateT <- aggregate(accNon ~ workerId, sum, data=dataExp1)
farateT$fa_rate <- round(farateT$accNon/209,3)

# Manually correct the FA rate of one participant (who did two less items)
#length(which(dataExp1$type=="non" & dataExp1$workerId=="f06d0f73"))
farateT[farateT$workerId=="f06d0f73",]$fa_rate <- round(farateT[farateT$workerId=="f06d0f73",]$accNon/207,3)
dprime <- merge(hrateT, farateT, by="workerId")
dprime$dprime <- round(qnorm(dprime$hit_rate) - qnorm(dprime$fa_rate),3)
dprime <- dprime[c("workerId","dprime")]
drop <- c("accReal","accNon")
dataExp1 <- dataExp1[,!(names(dataExp1) %in% drop)]
dataExp1 <- merge(dataExp1, dprime, by="workerId")
rm(dprime, hrateT, farateT)

# Remove 4 participants whose d-prime value is lower than 0
rmParticipant2Exp1 <- unique(dataExp1[dataExp1$dprime < 0,]$workerId) 
# a29fe31d e1f518e6 efdd3439 f57a3633 
dataExp1 <- dataExp1[!dataExp1$workerId %in% rmParticipant2Exp1,]           

# Remove one native speaker of Mandarin Chinese
dataExp1 <- dataExp1[!dataExp1$firstLang=="Mandarin",]

# Remove 11 participants whose speakMaori or compMaori is equal to or above 3
rmParticipant3Exp1 <- unique(dataExp1[dataExp1$speakMaori >= 3 | dataExp1$compMaori >= 3,]$workerId)
# 007a1752 170ce007 20c10896 3128bb29 66d0a920 75caca3b b00cd565 d3cd7085 de95cdaf eef4d9c0 fab8a51f
dataExp1 <- dataExp1[!dataExp1$workerId %in% rmParticipant3Exp1,]

# Remove one participant who did not learn their English in NZ and have been living overseas for more than two years.
summaryExp1WorkerId <- unique(dataExp1[,c("workerId","firstLangCountry","place","duration")])
EngNotInNZExp1 <- summaryExp1WorkerId[!summaryExp1WorkerId$firstLangCountry=="NZ",]
rmParticipant4Exp1 <- unique(EngNotInNZExp1[EngNotInNZExp1$place=="overseas",]$workerId) 
# 880242c2
dataExp1 <- dataExp1[!dataExp1$workerId %in% rmParticipant4Exp1,]

# Detect participant whose median reactionTime is shorter than 2*SD below the mean of all participants
median_RT <- aggregate(dataExp1$reactionTime, by=list(dataExp1$workerId), median)
names(median_RT) <- c("workerId","median")
cut <- mean(median_RT$median)-2*sd(median_RT$median)
# median_RT[!median_RT$median > cut,]$workerId # None detected!

# Check the total number of usable participants for Exp1
#length(unique(dataExp1$workerId)) # 101
```

## Dataset structure
The data is structured as follows:

  - *workerId* is the unique ID for each participant.
  - *enteredResponse* is the wellformedness rating for each stimulus.
  - *reactionTime* is the reaction time for each rating (seconds).
  - *type* is the classification of each stimulus: nonword ('non') or word ('real').
  - *length* is the phoneme length of each stimulus.
  - *word* is the stimulus used for the rating.
  - *speakMaori* is each participant's report of how well they can speak Māori (on a scale from 0 to 5).
  - *compMaori* is each participant's report of how well they can understand/read Māori (on a scale from 0 to 5). 
  - *maoriProf* is the sum of quantified response for speakMaori and compMaori (participant Māori proficiency).
  - *age* is the age group for each participant.
  - *gender* is the gender reported by each participant. 
  - *ethnicity* is categorized into binary answers, either Māori (M) or non Māori (non M).
  - *education* is each participant's highest level of education.
  - *children* is each participant's report of whether they have had any children who have attended preschool or primary school in New Zealand in the past five years.
  - *maoriList* is each participant's basic knowledge of Māori (with a scale ranging from 0 to 9).
  - *place* is each participant's current place of living (3 levels: NZ North Island, NZ South Island, or Overseas).
  - *duration* is each participant's time living in their current place (2 levels: long is > 2 years; short is =< 2 years).
  - *firstLang* is each participant's first language.
  - *firstLangCountry* is the country where each participant learned their first language.  
  - *anyOtherLangs* is any other languages each participant reports speaking.
  - *hawaii* is the binary response to the question whether participants have lived in Hawaii.
  - *anyPolynesian* is the binary response to the question whether participants know any Polynesian such as Hawaiian, Tahitian, Sāmoan, or Tongan.
  - *whichPolynesian* is the information regarding participants' knowledge of Polynesian languages, if they know any.
  - *impairments* is the answer to the question whether participants have a history of any speech or language impairments.
  - *maoriExpo* is each participant's level of exposure to Māori (with a scale ranging from 0 to 10).
  - *scoreDictType* is the type-based dictionary phonotactic score normalized by the phonemic length of each stimulus.
  - *scoreDictToken* is the frequency-weighted dictionary phonotactic score normalized by the phonemic length of each stimulus.
  - *scoreRsSeg* is the segmented running speech phonotactic score normalized by the phonemic length of each stimulus.
  - *n.neighbors* is the the number of words (from the Māori dictionary) that can be reached by adding, deleting, or substituting one phoneme in each stimulus.
  - *mean.neighbor.logfreq* is the frequency-weighted phonological neighbourhood density.
  - *dprime* is the measure of sensitivity for each participant's performance.

## Figure 1: Overview of participants’ sociolinguistic profile in Experiment 1
```{r fig.1, echo=FALSE, message=FALSE, warning=FALSE, evaluate=FALSE, fig.width=9, fig.height=6, fig.cap="Figure 1: Overview of participants' sociolinguistic profile in Experiment 1. Bars are labeled with their counts for each category."} 
# Gender
Exp1Gender <- unique(dataExp1[,c("gender","workerId")])
Exp1GenderT <- as.data.frame(table(Exp1Gender$gender));names(Exp1GenderT) <- c("gender","freq")
Fig1Exp1Gender <- ggplot(Exp1Gender, aes(x=gender,color=gender,fill=gender)) + theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp1GenderT, aes(x=gender,y=freq,label=freq), color="black", vjust=-0.2,size=3)+labs(x="Gender",y="Number of participants") + coord_cartesian(ylim=c(0, 80))

# Education
Exp1Education <- unique(dataExp1[,c("education","workerId")]);Exp1Education$education <- as.factor(Exp1Education$education)
Exp1EducationT <- as.data.frame(table(Exp1Education$education));names(Exp1EducationT) <- c("education","freq")
edu_levels <- c("high","undergraduate","graduate")
Exp1Education$education <- factor(Exp1Education$education, levels = edu_levels)
Exp1EducationT$education <- factor(Exp1EducationT$education, levels = edu_levels)
Fig1Exp1Education <- ggplot(Exp1Education, aes(x=education,color=education,fill=education)) + theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp1EducationT, aes(x=education,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x="Highest education",y="Number of participants") + coord_cartesian(ylim=c(0, 52))

# Basic knowledge of Māori
Exp1ML <- unique(dataExp1[,c("maoriList","workerId")]);Exp1ML$maoriList <- as.factor(Exp1ML$maoriList)
Exp1MLT <- as.data.frame(table(Exp1ML$maoriList));names(Exp1MLT) <- c("maoriList","freq")
Fig1Exp1ML <- ggplot(Exp1ML, aes(x=maoriList,color=maoriList,fill=maoriList))+theme_classic()+ geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp1MLT, aes(x=maoriList,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x="Basic knowledge of Māori",y="Number of participants") + coord_cartesian(ylim=c(0, 20))
  
# Age
Exp1Age <- unique(dataExp1[,c("age","workerId")]);Exp1Age$age <- as.factor(Exp1Age$age)
Exp1Age$age <- factor(Exp1Age$age, levels=c("18-29", "30-39", "40-49", "50-59", "+60"))
Exp1AgeT <- as.data.frame(table(Exp1Age$age));names(Exp1AgeT) <- c("age","freq")
Exp1AgeT$age <- factor(Exp1AgeT$age, levels=c("18-29", "30-39", "40-49", "50-59", "+60"))
Fig1Exp1Age <- ggplot(Exp1Age, aes(x=age,color=age,fill=age))+theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp1AgeT, aes(x=age,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x="Age",y="Number of participants") + coord_cartesian(ylim=c(0, 36))

# Place
Exp1Place <- unique(dataExp1[,c("place","workerId")]);Exp1PlaceT <- as.data.frame(table(Exp1Place$place));names(Exp1PlaceT) <- c("place","freq")
place_levels <- c("north","south","overseas")
Exp1Place$place <- factor(Exp1Place$place, levels = place_levels)
Exp1PlaceT$place <- factor(Exp1PlaceT$place, levels = place_levels)
Fig1Exp1Place <- ggplot(Exp1Place, aes(x=place, color=place, fill= place)) + theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp1PlaceT,aes(x=place,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x = "Place", y = "Number of participants") + coord_cartesian(ylim=c(0, 55))

# Exposure to Māori
Exp1ME <- unique(dataExp1[,c("maoriExpo","workerId")]);Exp1ME$maoriExpo <- as.factor(Exp1ME$maoriExpo)
Exp1MET <- as.data.frame(table(Exp1ME$maoriExpo));names(Exp1MET) <- c("maoriExpo","freq")
Fig1Exp1ME <- ggplot(Exp1ME, aes(x=maoriExpo, color=maoriExpo, fill=maoriExpo))+theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp1MET, aes(x=maoriExpo,y=freq,label=freq), color="black", vjust=-0.2,size=3)+labs(x="Level of exposure",y="Number of participants") + coord_cartesian(ylim=c(0, 28))

multiplot(Fig1Exp1Gender, Fig1Exp1Education, Fig1Exp1ML, Fig1Exp1Age, Fig1Exp1Place, Fig1Exp1ME, cols=2) 
```

## Figure 3: Length distribution of real word stimuli
```{r fig.3, echo=FALSE, message=FALSE, warning=FALSE, evaluate=FALSE, fig.width=8, fig.height=4.5, fig.cap="Figure 3: Length distribution of real word stimuli. The length of stimulus (the number of phonemes) is represented on the x-axis and the number of stimuli is represented on the y-axis."} 
# Figure3 - length distribution
lengthT <- unique(dataExp1[c("word", "length","type")]);lengthT <- lengthT[lengthT$type=="real",]
lengthT$length <- as.factor(lengthT$length)
lengthTT <- as.data.frame(table(lengthT$length));names(lengthTT) <- c("length","freq")

ggplot(lengthT, aes(x = length, color= length, fill= length))  + theme_classic() + 
geom_bar(aes(fill= length, color= length),size=.1,show.legend=F) + labs(x = "Length", y = "Number of stimuli") +
geom_text(data=lengthTT, aes(x=length, y=freq, label=freq),color="black", vjust=-0.2, size=3) + 
theme(legend.position="none")
```

## Figure 4: Average rating per word 
```{r fig.4, echo=FALSE, message=FALSE, warning=FALSE, evaluate=FALSE, fig.width=9, fig.height=6, fig.cap="Figure 4: Average word ratings by phonotactic score. Overlapping labels are not plotted."} 
# Figure4
# Type-based dictionary phonotactic score
meanRatings <- aggregate(dataExp1$enteredResponse, by=list(dataExp1$word),  FUN=mean)
colnames(meanRatings) <- c("word","mean")
Fig4T <- unique(dataExp1[c("word","type","scoreDictType")])
Fig4T <- merge(Fig4T, meanRatings, by="word")
Fig4T$Type <- "Nonword";Fig4T[Fig4T$type=="real",]$Type <- "Word"
Fig4T$id <- seq_along(Fig4T$word);listID <- Fig4T$id[seq.int(1, length(Fig4T$id),5)]
Fig4T <- Fig4T[order(Fig4T$score, decreasing=FALSE),]
ggplot(Fig4T, aes(x=scoreDictType, y=mean, group=Type, label=word)) + labs(x= "Phonotactic score (DictType)", y="Average rating") + theme_classic() + theme(legend.title=element_blank()) + geom_point(aes(color=Type,shape=Type),size=3) + geom_text(hjust=0.2,vjust=-0.7,check_overlap = TRUE, size=4) + scale_colour_manual(values=c("#F8766D", "#00BFC4")) + coord_cartesian(xlim=c(-0.45,-1.6)) 

# Token-based dictionary phonotactic score
meanRatings <- aggregate(dataExp1$enteredResponse, by=list(dataExp1$word),  FUN=mean)
colnames(meanRatings) <- c("word","mean")
Fig4T <- unique(dataExp1[c("word","type","scoreDictToken")])
Fig4T <- merge(Fig4T, meanRatings, by="word")
Fig4T$Type <- "Nonword";Fig4T[Fig4T$type=="real",]$Type <- "Word"
Fig4T$id <- seq_along(Fig4T$word);listID <- Fig4T$id[seq.int(1, length(Fig4T$id),5)]
Fig4T <- Fig4T[order(Fig4T$score, decreasing=FALSE),]
ggplot(Fig4T, aes(x=scoreDictToken, y=mean, group=Type, label=word)) + labs(x= "Phonotactic score (DictToken)", y="Average rating") + theme_classic() + theme(legend.title=element_blank()) + geom_point(aes(color=Type,shape=Type),size=3) + geom_text(hjust=0.2,vjust=-0.7,check_overlap = TRUE, size=4) + scale_colour_manual(values=c("#F8766D", "#00BFC4")) 

# Running speech phonotactic score
meanRatings <- aggregate(dataExp1$enteredResponse, by=list(dataExp1$word),  FUN=mean)
colnames(meanRatings) <- c("word","mean")
Fig4T <- unique(dataExp1[c("word","type","scoreRsSeg")])
Fig4T <- merge(Fig4T, meanRatings, by="word")
Fig4T$Type <- "Nonword";Fig4T[Fig4T$type=="real",]$Type <- "Word"
Fig4T$id <- seq_along(Fig4T$word);listID <- Fig4T$id[seq.int(1, length(Fig4T$id),5)]
Fig4T <- Fig4T[order(Fig4T$score, decreasing=FALSE),]
ggplot(Fig4T, aes(x=scoreRsSeg, y=mean, group=Type, label=word)) + labs(x= "Phonotactic score (RsSeg)", y="Average rating") + theme_classic() + theme(legend.title=element_blank()) + geom_point(aes(color=Type,shape=Type),size=3) + geom_text(hjust=0.2,vjust=-0.7,check_overlap = TRUE, size=4) + scale_colour_manual(values=c("#F8766D", "#00BFC4")) + coord_cartesian(xlim=c(-0.7,-1.8)) 
```

## Table1: Modeling confidence ratings with an ordinal mixed effects model

[ST: This model has a random slope for dprime by word, but no random intercept for word (0 + c.(dprime) | word). Was that a mistake based on trying the advice to decorrelate random effects? It seems very unusual... if you just want to decorrelate the intercept from the slope, you would need (1 | word) + (0 + dprime | word)]

[ST: Is the model fitting procedure outlined clearly in the paper? Since there are no comments along the way here, it might be hard to reconstruct without extremely clear guidance.]

```{r Table.1, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# Model for Table 1
dataExp1DprimeFinite <- dataExp1[is.finite(dataExp1$dprime),]
dataExp1DprimeFinite$macron <- FALSE
dataExp1DprimeFinite[grepl("ā|ē|ī|ō|ū",dataExp1DprimeFinite$word),]$macron <- TRUE
dataExp1DprimeFinite$macron <- as.factor(dataExp1DprimeFinite$macron)
dataExp1DprimeFinite$enteredResponse <- as.factor(dataExp1DprimeFinite$enteredResponse)
# modelTable1 <- clmm(enteredResponse ~ macron*type*c.(dprime) + c.(n.neighbors)*type*c.(dprime) + c.(length)*c.(dprime) + c.(scoreDictToken) + (1 + macron*type + c.(n.neighbors)*type| workerId) + (1 + c.(length) + c.(scoreDictToken)| workerId) + (0 + c.(dprime)|word), data=dataExp1DprimeFinite)
# saveRDS(modelTable1, file = "modelTable1.rds")
modelTable1 <- readRDS("./modelTable1.rds")  
clm_table(modelTable1, caption="Table 1: Model summary of confidence ratings with an ordinal mixed effects model. All numeric variables in this model are centered.")
``` 

## Figure 5: Effect plots from the model presented in Table 1

[ST: I suggest making the color scheme for these plots the same as the one used for the raw data plots; either set nonwords to black and real words to blue in those raw data plots, or set the colors here to match those used earlier. (Similarly for the shapes, if they are not already the same)]

[ST: It is probably worth increasing the font size of the axis labels, since they get pretty small in the final figure.]

[ST: In these plots, I chose dprime values of 1 and 3 as cuts, because they show the different behaviors well and fit easily in the labels. You can change them if you want -- but if you want to use quartile values, then I suggest you use the quantile function as commented out in the code, because the values it calculates are *different* to the ones you had there before (likely due to updates in the data with exclusions etc.). If you stick with 1 and 3, it would be helpful either here or in the paper (where any figure is presented) to briefly indicate what a dprime of 1 or 3 represents, and where those values fall in the overall distribution of dprimes across participants.]

```{r Fig.5, echo=FALSE, message=FALSE, warning=FALSE, fig.width=11, fig.height=12, fig.cap="Figure 5: Effect plots of: the interaction between the presence of macrons, the distinction between non vs. real word stimuli, and participant d' (Fig.5a); the interaction between the neighbourhood density, the distinction between non vs. real word stimuli, and participant d' (Fig.5b); the interaction between the stimulus length and participant d' (Fig.5b); and the frequency-weighted dictionary phonotactic score (Fig.5d). For plots involving interactions with paricipant d', the upper panel represents participants with high d', and the lower panel represents participants with low d'. Plots on the left show predicted mean ratings and plots on the right show predicted distributions over ratings."}
dprimes = dataExp1DprimeFinite %>% group_by(workerId, dprime) %>% summarise() %>% pull(dprime)
dprime_cuts = c(3, 1) # quantile(dprimes, p=c(0.75, 0.25))
yrange = c(2.3, 5)

# 1) Type*Macron*Dprime
Figure5_mean_1 <- clm_plotdat(modelTable1, c("type", "macron", "dprime"), xlevels=list(dprime=dprime_cuts), type="mean") %>%
  mutate(
    type = fct_recode(type, "Nonword"="non", "Word"="real") %>% fct_relevel("Word"),
    macron = fct_recode(macron, "Yes"="TRUE", "No"="FALSE"),
    dprime = factor(dprime, levels=dprime_cuts)
  ) %>%
  ggplot(., aes(x=macron, y=pred, color=type, shape=type)) +
  geom_point(size=4, position=position_dodge(width=0.2)) +
  geom_line(aes(x=as.integer(macron)), size=1, alpha=0.4, position=position_dodge(width=0.2)) +
  geom_errorbar(aes(ymin=lci, ymax=uci), size=1, width=0.3, position=position_dodge(width=0.2)) +
  xlab("Presence of macron") +
  ylab("Predicted mean rating") + 
  facet_grid(dprime ~ ., labeller=label_both, switch="y") +
  ylim(yrange) +
  scale_shape_manual(values = c("Nonword" = 19, "Word" = 17)) + 
  scale_color_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  scale_fill_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  theme_bw() + 
  theme(
    legend.position="none",
    panel.background = element_blank()
  )

Figure5_dist_1 <- clm_plotdat(modelTable1, c("type", "macron", "dprime"), xlevels=list(dprime=dprime_cuts), type="dist") %>%
  mutate(
    type = fct_recode(type, "Nonword"="non", "Word"="real") %>% fct_relevel("Word"),
    macron = fct_recode(macron, "Yes"="TRUE", "No"="FALSE"),
    dprime = factor(dprime, levels=dprime_cuts)
  ) %>%
  rename("Rating" = response) %>%
  ggplot(., aes(x=macron, y=pred, color=type, shape=type)) +
  geom_point(size=4, position=position_dodge(width=0.2)) +
  geom_line(aes(x=as.integer(macron)), size=1, alpha=0.4, position=position_dodge(width=0.2)) +
  geom_errorbar(aes(ymin=lci, ymax=uci), size=1, width=0.3, position=position_dodge(width=0.2)) +
  xlab("Presence of macron") +
  ylab("Probability of rating") + 
  scale_shape_manual(values = c("Nonword" = 19, "Word" = 17)) + 
  scale_color_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  scale_fill_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  facet_grid(dprime ~ Rating, labeller=label_both, switch="y") +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    legend.position="right",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

# 2) Type*Neighbourhood density*Dprime
Figure5_mean_2 <- clm_plotdat(modelTable1, c("type", "n.neighbors", "dprime"), xlevels=list(dprime=dprime_cuts), type="mean") %>%
  mutate(
    type = fct_recode(type, "Nonword"="non", "Word"="real") %>% fct_relevel("Word"),
    dprime = factor(dprime, levels=dprime_cuts)
  ) %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.2, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Predicted mean rating") + 
  facet_grid(dprime ~ ., labeller=label_both, switch="y") +
  ylim(yrange) +
  scale_color_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  scale_fill_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  theme_bw() + 
  theme(
    legend.position="none",
    panel.background = element_blank()
  )

Figure5_dist_2 <- clm_plotdat(modelTable1, c("type", "n.neighbors", "dprime"), xlevels=list(dprime=dprime_cuts), type="dist") %>%
  mutate(
    type = fct_recode(type, "Nonword"="non", "Word"="real") %>% fct_relevel("Word"),
    dprime = factor(dprime, levels=dprime_cuts)
  ) %>%
  rename("Rating" = response) %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.2, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  scale_fill_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  facet_grid(dprime ~ Rating, labeller=label_both, switch="y") +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    legend.position="right",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

# 3) Dprime*Length
Figure5_mean_3 <- clm_plotdat(modelTable1, c("length", "dprime"), xlevels=list(dprime=dprime_cuts, length=25), type="mean") %>%
  mutate(
    dprime = factor(dprime, levels=dprime_cuts),
    type = "Word and\nNonword"
  ) %>%
  ggplot(., aes(x=length, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.2, color=NA) +
  geom_line(size=1) +
  xlab("Stimulus length") +
  ylab("Predicted mean rating") + 
  facet_grid(dprime ~ ., labeller=label_both, switch="y") +
  ylim(yrange) +
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) + 
  theme_bw() + 
  theme(
    legend.position="none",
    panel.background = element_blank()
  )

Figure5_dist_3 <- clm_plotdat(modelTable1, c("length", "dprime"), xlevels=list(dprime=dprime_cuts, length=25), type="dist") %>%
  mutate(
    dprime = factor(dprime, levels=dprime_cuts),
    type = "Word and\nNonword"
  ) %>%
  rename("Rating" = response) %>%
  ggplot(., aes(x=length, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.2, color=NA) +
  geom_line(size=1) +
  xlab("Stimulus length") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +
  facet_grid(dprime ~ Rating, labeller=label_both, switch="y") +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    legend.position="right",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

# 4) Phonotactic score
Figure5_mean_4 <- clm_plotdat(modelTable1, "scoreDictToken", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Predicted mean rating") + 
  ylim(yrange) +
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_classic() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

Figure5_dist_4 <- clm_plotdat(modelTable1, "scoreDictToken", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

ggarrange(Figure5_mean_1, Figure5_dist_1,Figure5_mean_2,Figure5_dist_2, Figure5_mean_3,Figure5_dist_3, Figure5_mean_4, Figure5_dist_4, labels=c("a.", "","b.","","c.","", "d.", ""),ncol=2, widths=c(1,6), heights=c(2,2,2,1))
```

## TableS1: Modeling confidence ratings with an ordinal mixed effects model after discarding 50 nonwords based on token-based dictionary phonotasctic scores

[ST: This is all commented out, and the corresponding model file isn't in the repository. Should this still be here?]

```{r Table.S1, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# Model for Table S1
dataExp1DScore <- dataExp1DprimeFinite[dataExp1DprimeFinite$scoreDictToken > min(dataExp1DprimeFinite[dataExp1DprimeFinite$type=="real",]$scoreDictToken),]
# modelTableS1 <- clmm(enteredResponse ~ macron*type*c.(dprime) + c.(n.neighbors)*type*c.(dprime) + c.(length)*c.(dprime) + c.(scoreDictToken) + (1 + macron*type + c.(n.neighbors)*type| workerId) + (1 + c.(length) + c.(scoreDictToken)| workerId) + (0 + c.(dprime)|word), data=dataExp1DScore)
# saveRDS(modelTableS1, file = "modelTableS1.rds")
# modelTableS1 <- readRDS("./modelTableS1.rds")  
# clm_table(modelTableS1, caption="Table S1: Model summary of confidence ratings with an ordinal mixed effects model. All numeric variables in this model are centered.")
``` 

## Statistical models with self-reported survey measures

[ST: The question I raised about model fitting procedures earlier is also important here, since these models are supposed to be comparable in some way, but it is hard to compare them when they have different predictors and it's not clear where those differences come from.]

### Model A: Participants’ self-evaluated level of Māori proficiency
```{r Table.S2, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
dataExp1$macron <- FALSE
dataExp1[grepl("ā|ē|ī|ō|ū",dataExp1$word),]$macron <- TRUE
dataExp1$macron <- as.factor(dataExp1$macron)
dataExp1$enteredResponse <- as.factor(dataExp1$enteredResponse)
# modelA <- clmm(enteredResponse ~ c.(scoreDictToken) + c.(n.neighbors) + macron + c.(length)*c.(maoriProf) + type*c.(maoriProf) + (1 + c.(scoreDictToken) + c.(n.neighbors) + macron | workerId) + (1 + c.(length) + type | workerId) + (0 + c.(maoriProf) | word), data=dataExp1)
# saveRDS(modelA, file = "modelA.rds")
modelA <- readRDS("./modelA.rds")  
clm_table(modelA, caption="Table S2: Model summary of confidence ratings with an ordinal mixed effects model. All numeric variables in this model are centered.")
```

### Figure S1: Effect plots from Model A (Participants’ self-evaluated level of Māori proficiency)

[ST: I don't know why you had only plotted a subset of the effects from these models. I included all of the effects in this plot, as a demonstration for how it would be done. You'll need to repeat this for the other models, or if you only wanted certain effects plotted, then you'll need to convert this plot back to something that resembles the others.]

```{r Fig.S1, echo=FALSE, message=FALSE, warning=FALSE, fig.width=11, fig.height=12.5, fig.cap="Figure S1: Effect plots of: the interaction between self-rated Māori proficiency and the distinction between non vs. real word stimuli (Fig.S1a); the interaction between self-rated Māori proficiency and stimulus length (Fig.S1b); the frequency-weighted dictionary phonotactic score (Fig.S1c); the neighbourhood density (Fig.S1d); and the presence of a macron (Fig.S1e). Plots on the left show predicted mean ratings and plots on the right show predicted distributions over ratings."}
prof_cuts = c(4, 0)

# 1) Proficiency*Type
FigureS1_mean_1 <- clm_plotdat(modelA, c("type", "maoriProf"), xlevels=list(maoriProf=prof_cuts), type="mean") %>%
  mutate(
    type = fct_recode(type, "Nonword"="non", "Word"="real") %>% fct_relevel("Word"),
    maoriProf = factor(maoriProf)
  ) %>%
  ggplot(., aes(x=maoriProf, y=pred, color=type, shape=type)) +
  geom_point(size=4, position=position_dodge(width=0.2)) +
  geom_line(aes(x=as.integer(maoriProf)), size=1, alpha=0.4, position=position_dodge(width=0.2)) +
  geom_errorbar(aes(ymin=lci, ymax=uci), size=1, width=0.3, position=position_dodge(width=0.2)) +
  xlab("Māori proficiency") +
  ylab("Predicted mean rating") +
  ylim(yrange) +
  scale_shape_manual(values = c("Nonword" = 19, "Word" = 17)) + 
  scale_color_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  scale_fill_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  theme_bw() + 
  theme(
    legend.position="none",
    panel.background = element_blank()
  )

FigureS1_dist_1 <- clm_plotdat(modelA, c("type", "maoriProf"), xlevels=list(maoriProf=prof_cuts), type="dist") %>%
  mutate(
    type = fct_recode(type, "Nonword"="non", "Word"="real") %>% fct_relevel("Word"),
    maoriProf = factor(maoriProf)
  ) %>%
  rename("Rating" = response) %>%
  ggplot(., aes(x=maoriProf, y=pred, color=type, shape=type)) +
  geom_point(size=4, position=position_dodge(width=0.2)) +
  geom_line(aes(x=as.integer(maoriProf)), size=1, alpha=0.4, position=position_dodge(width=0.2)) +
  geom_errorbar(aes(ymin=lci, ymax=uci), size=1, width=0.3, position=position_dodge(width=0.2)) +
  xlab("Māori proficiency") +
  ylab("Probability of rating") + 
  scale_shape_manual(values = c("Nonword" = 19, "Word" = 17)) + 
  scale_color_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  scale_fill_manual(values = c("Nonword" = "black", "Word" = "blue")) +
  facet_grid(. ~ Rating, labeller=label_both, switch="y") +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    legend.position="right",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

# 2) Proficiency*Length
FigureS1_mean_2 <- clm_plotdat(modelA, c("length", "maoriProf"), xlevels=list(maoriProf=prof_cuts, length=25), type="mean") %>%
  mutate(
    type="Word and\nNonword",
    maoriProf = factor(maoriProf, levels=prof_cuts)
  ) %>%
  ggplot(., aes(x=length, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Stimulus length") +
  ylab("Predicted mean rating") +
  ylim(yrange) +
  facet_grid(maoriProf ~ ., labeller=label_both, switch="y") +
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) + 
  theme_bw() + 
  theme(
    legend.position="none",
    panel.background = element_blank()
  )

FigureS1_dist_2 <- clm_plotdat(modelA, c("length", "maoriProf"), xlevels=list(maoriProf=prof_cuts, length=25), type="dist") %>%
  mutate(
    type = "Word and\nNonword",
    maoriProf = factor(maoriProf, levels=prof_cuts)
  ) %>%
  rename("Rating" = response) %>%
  ggplot(., aes(x=length, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Stimulus length") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) + 
  facet_grid(maoriProf ~ Rating, labeller=label_both, switch="y") +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    legend.position="right",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

# 3) Phonotactic score
FigureS1_mean_3 <- clm_plotdat(modelA, "scoreDictToken", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Predicted mean rating") + 
  ylim(yrange) +
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS1_dist_3 <- clm_plotdat(modelA, "scoreDictToken", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

# 4) Neighbourhood density
FigureS1_mean_4 <- clm_plotdat(modelA, "n.neighbors", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Predicted mean rating") + 
  ylim(yrange) +
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS1_dist_4 <- clm_plotdat(modelA, "n.neighbors", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

# 5) Macron
FigureS1_mean_5 <- clm_plotdat(modelA, "macron", type="mean") %>%
  mutate(
    type="Word and\nNonword",
    macron = fct_recode(macron, "Yes"="TRUE", "No"="FALSE")
  ) %>%
  ggplot(., aes(x=macron, y=pred, color=type, fill=type)) +
  geom_point(size=4, position=position_dodge(width=0.2)) +
  geom_line(aes(x=as.integer(macron)), size=1, alpha=0.4, position=position_dodge(width=0.2)) +
  geom_errorbar(aes(ymin=lci, ymax=uci), size=1, width=0.3, position=position_dodge(width=0.2)) +
  xlab("Presence of macron") +
  ylab("Predicted mean rating") + 
  ylim(yrange) +
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS1_dist_5 <- clm_plotdat(modelA, "macron", type="dist") %>%
  mutate(
    type="Word and\nNonword",
    macron = fct_recode(macron, "Yes"="TRUE", "No"="FALSE")
  ) %>%
  ggplot(., aes(x=macron, y=pred, color=type, fill=type)) +
  geom_point(size=4, position=position_dodge(width=0.2)) +
  geom_line(aes(x=as.integer(macron)), size=1, alpha=0.4, position=position_dodge(width=0.2)) +
  geom_errorbar(aes(ymin=lci, ymax=uci), size=1, width=0.3, position=position_dodge(width=0.2)) +
  xlab("Presence of macron") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

ggarrange(FigureS1_mean_1, FigureS1_dist_1, FigureS1_mean_2, FigureS1_dist_2, FigureS1_mean_3, FigureS1_dist_3, FigureS1_mean_4, FigureS1_dist_4, FigureS1_mean_5, FigureS1_dist_5, labels=c("a.", "","b.","","c.","","d.","","e.",""),ncol=2, widths=c(1,6), heights=c(1,2,1,1,1))
``` 

### Model B: Participants’ self-reported level of exposure to Māori
```{r Table.S3, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# modelB <- clmm(enteredResponse ~ c.(scoreDictToken) + c.(n.neighbors) + macron  + type +  c.(length) + c.(maoriExpo) + (1 + c.(scoreDictType) + c.(n.neighbors) + macron | workerId) + (1 + type + c.(length) | workerId) + (0 + c.(maoriExpo) |word), data=dataExp1)
# saveRDS(modelB, file = "modelB.rds")
modelB <- readRDS("./modelB.rds")   
clm_table(modelB, caption="Table S3: Model summary of confidence ratings with an ordinal mixed effects model. All numeric variables in this model are centered.")
```

### Figure S2: Effect plots from Model B (Participants’ self-reported level of exposure to Māori)
```{r Fig.S2, echo=FALSE, message=FALSE, warning=FALSE, fig.width=11, fig.height=4.5, fig.cap="Figure S2: Effect plots of phonotactic score (Fig.S1a) and neighbourhood density (Fig.S1b). Plots on the left show predicted mean ratings and plots on the right show predicted distributions over ratings."}
# 1) Phonotactic score
FigureS2_mean_1 <- clm_plotdat(modelB, "scoreDictToken", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Predicted mean rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_classic() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS2_dist_1 <- clm_plotdat(modelB, "scoreDictToken", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

# 2) Neighbourhood density
FigureS2_mean_2 <- clm_plotdat(modelB, "n.neighbors", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Predicted mean rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_classic() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS2_dist_2 <- clm_plotdat(modelB, "n.neighbors", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

ggarrange(FigureS2_mean_1, FigureS2_dist_1, FigureS2_mean_2, FigureS2_dist_2, labels=c("a.", "","b.",""),ncol=2, widths=c(1,6))
```

### Model C: Participants’ basic knowledge of Māori
```{r Table.S4, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# modelC <- clmm(enteredResponse ~  c.(n.neighbors)*c.(scoreDictToken)*c.(maoriList) + type*c.(maoriList) + c.(length) + macron  +  (1 + c.(n.neighbors)*c.(scoreDictToken) + type | workerId) + (1 + c.(length) + macron | workerId) + (0 + c.(maoriList) | word), data=dataExp1)
# saveRDS(modelC, file = "modelC.rds")
modelC <- readRDS("./modelC.rds")   
clm_table(modelC, caption="Table S4: Model summary of confidence ratings with an ordinal mixed effects model. All numeric variables in this model are centered.")
```

### Figure S3: Effect plots from Model C (Participants’ basic knowledge of Māori)
```{r Fig.S3, echo=FALSE, message=FALSE, warning=FALSE, fig.width=11, fig.height=4.5, fig.cap="Figure S3: Effect plots of phonotactic score (Fig.S1a) and neighbourhood density (Fig.S1b). Plots on the left show predicted mean ratings and plots on the right show predicted distributions over ratings."}
# 1) Phonotactic score
FigureS3_mean_1 <- clm_plotdat(modelC, "scoreDictToken", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Predicted mean rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_classic() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS3_dist_1 <- clm_plotdat(modelC, "scoreDictToken", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=scoreDictToken, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Phonotactic score") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

# 2) Neighbourhood density
FigureS3_mean_2 <- clm_plotdat(modelC, "n.neighbors", xlevels=25, type="mean") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Predicted mean rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +    
  theme_classic() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="none",
    legend.title=element_blank(),
    panel.background = element_blank()
  )

FigureS3_dist_2 <- clm_plotdat(modelC, "n.neighbors", xlevels=25, type="dist") %>%
  mutate(type="Word and\nNonword") %>%
  ggplot(., aes(x=n.neighbors, y=pred, color=type, fill=type)) +
  geom_ribbon(aes(ymin=lci, ymax=uci), alpha=0.3, color=NA) +
  geom_line(size=1) +
  xlab("Neighbourhood density") +
  ylab("Probability of rating") + 
  scale_color_manual(values = c("Word and\nNonword" = "purple")) +
  scale_fill_manual(values = c("Word and\nNonword" = "purple")) +  
  facet_grid(. ~ response, labeller=as_labeller(function(x) str_c("Rating: ", x))) +
  ylim(0, 1) +  
  theme_bw() + 
  theme(
    plot.title = element_text(hjust = 0.5, size=15),
    legend.position="right",
    legend.title=element_blank()
  ) 

ggarrange(FigureS3_mean_1, FigureS3_dist_1, FigureS3_mean_2, FigureS3_dist_2, labels=c("a.", "","b.",""),ncol=2, widths=c(1,6))
```

# Experiment 2
## Participant exclusions
```{r loading_data_Exp2, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the data to filter out participants
dataExp2 <- read.delim("./dataAnonNotFilteredExp2_added.txt", sep ="\t", header = TRUE, encoding="UTF-8")

# Remove 9 participants whose speakMaori or compMaori is equal to or above 3
rmParticipant1Exp2 <- unique(dataExp2[dataExp2$speakMaori >= 3 | dataExp2$compMaori >= 3,]$workerId) 
# 1b817b93 f44d2e0f 2d528dd7 90e5e8cd aa592fef a95bbe09 35ace421 b3f52c92 e7a6cb02
dataExp2 <- dataExp2[!dataExp2$workerId %in% rmParticipant1Exp2,]

# Remove one participant who did not learn their English in NZ and have been living overseas for more than two years (duration == "long")
summaryExp2WorkerId <- unique(dataExp2[,c("workerId","firstLangCountry","place","duration")])
EngNotInNZExp2 <- summaryExp2WorkerId[!summaryExp2WorkerId$firstLangCountry=="NZ",]
rmParticipant2Exp2 <- unique(EngNotInNZExp2[EngNotInNZExp2$place=="overseas",]$workerId) 
# 1e48b18a
dataExp2 <- dataExp2[!dataExp2$workerId %in% rmParticipant2Exp2,]

# Detect participant whose median reactionTime is shorter than 2*SD below the mean of all participants
median_RT <- aggregate(dataExp2$reactionTime, by=list(dataExp2$workerId), median)
names(median_RT) <- c("workerId","median")
cut <- mean(median_RT$median)-2*sd(median_RT$median)
# median_RT[!median_RT$median > cut,]$workerId # None detected!

# Remove a participant with joke answers
dataExp2 <- dataExp2[!dataExp2$workerId=="eaed6b4d",]

# Check the total number of usable participants for Exp2
# length(unique(dataExp2$workerId)) # 123
```

## Dataset structure
The data is structured as follows:

  - *workerId* is the unique ID for each participant.
  - *definition* is each participant's entered definition for each stimulus.
  - *coding* is the marking for each definition.
  - *correct* is binary: either the definition is correct (TRUE) or incorrect (FALSE).
  - *confidence* is each participant's confidence rating for each definition. (on a scale from 0 to 5). 
  - *familiarity* is the average rating for each Māori word obtained from 101 NMS New Zealanders in Experiment 1.
  - *reactionTime* is the reaction time for each rating (seconds).
  - *length* is the phoneme length of each stimulus.
  - *word* is the stimulus used for the rating.
  - *speakMaori* is each participant's report of how well they can speak Māori (on a scale from 0 to 5).
  - *compMaori* is each participant's report of how well they can understand/read Māori (on a scale from 0 to 5). 
  - *maoriProf* is the sum of quantified response for speakMaori and compMaori (participant Māori proficiency).
  - *age* is the age group for each participant.
  - *gender* is the gender reported by each participant. 
  - *ethnicity* is categorized into binary answers, either Māori (M) or non Māori (non M).
  - *education* is each participant's highest level of education.
  - *children* is each participant's report of whether they have had any children who have attended preschool or primary school in New Zealand in the past five years.
  - *maoriList* is each participant's basic knowledge of Māori (with a scale ranging from 0 to 9).
  - *place* is each participant's current place of living (3 levels: NZ North Island, NZ South Island, or Overseas).
  - *duration* is each participant's time living in their current place (2 levels: long is > 2 years; short is =< 2 years).
  - *firstLang* is each participant's first language.
  - *firstLangCountry* is the country where each participant learned their first language.  
  - *anyOtherLangs* is any other languages each participant reports speaking.
  - *hawaii* is the binary response to the question whether participants have lived in Hawaii.
  - *anyPolynesian* is the binary response to the question whether participants know any Polynesian such as Hawaiian, Tahitian, Sāmoan, or Tongan.
  - *whichPolynesian* is the information regarding participants' knowledge of Polynesian languages, if they know any.
  - *impairments* is the answer to the question whether participants have a history of any speech or language impairments.
  - *maoriExpo* is each participant's level of exposure to Māori (with a scale ranging from 0 to 10).
  - *scoreDictType* is the dictionary phonotactic score normalized by the phonemic length of each stimulus.
  - *scoreDictToken* is the frequency-weighted dictionary phonotactic score normalized by the phonemic length of each stimulus.
  - *scoreRsSeg* is the segmented running speech phonotactic score normalized by the phonemic length of each stimulus.
  - *n.neighbors* is the the number of words (from the Māori dictionary) that can be reached by adding, deleting, or substituting one phoneme in each stimulus.
  - *mean.neighbor.logfreq* is the frequency-weighted phonological neighbourhood density.

## Figure 2: Overview of participants’ sociolinguistic profile
```{r fig.2, echo=FALSE, message=FALSE, warning=FALSE, evaluate=FALSE, fig.width=9, fig.height=6, fig.cap="Figure 2: Overview of participants’ sociolinguistic profile in Experiment 2. Bars are labeled with their counts for each category."} 

# Gender
Exp2Gender <- unique(dataExp2[,c("gender","workerId")])
Exp2Gender$gender <- droplevels(Exp2Gender$gender)
Exp2GenderT <- as.data.frame(table(Exp2Gender$gender));names(Exp2GenderT) <- c("gender","freq")
Fig2Exp2Gender <- ggplot(Exp2Gender, aes(x=gender,color=gender,fill=gender)) + theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp2GenderT, aes(x=gender,y=freq,label=freq), color="black", vjust=-0.2,size=3)+labs(x="Gender",y="Number of participants") + coord_cartesian(ylim=c(0, 97))

# Education
Exp2Education <- unique(dataExp2[,c("education","workerId")]);Exp2Education$education <- as.factor(Exp2Education$education)
Exp2EducationT <- as.data.frame(table(Exp2Education$education));names(Exp2EducationT) <- c("education","freq")
edu_levels <- c("high","undergraduate","graduate")
Exp2Education$education <- factor(Exp2Education$education, levels = edu_levels)
Exp2EducationT$education <- factor(Exp2EducationT$education, levels = edu_levels)
Fig2Exp2Education <- ggplot(Exp2Education, aes(x=education,color=education,fill=education)) + theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp2EducationT, aes(x=education,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x="Highest education",y="Number of participants") + coord_cartesian(ylim=c(0, 58))

# Basic knowledge of Māori
Exp2ML <- unique(dataExp2[,c("maoriList","workerId")]);Exp2ML$maoriList <- as.factor(Exp2ML$maoriList)
Exp2MLT <- as.data.frame(table(Exp2ML$maoriList));names(Exp2MLT) <- c("maoriList","freq")
Fig2Exp2ML <- ggplot(Exp2ML, aes(x=maoriList,color=maoriList,fill=maoriList))+theme_classic()+ geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp2MLT, aes(x=maoriList,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x="Basic knowledge of Māori",y="Number of participants") + coord_cartesian(ylim=c(0, 28))

# Age
Exp2Age <- unique(dataExp2[,c("age","workerId")]);Exp2Age$age <- as.factor(Exp2Age$age)
Exp2Age$age <- factor(Exp2Age$age, levels=c("18-29", "30-39", "40-49", "50-59", "+60"))
Exp2AgeT <- as.data.frame(table(Exp2Age$age));names(Exp2AgeT) <- c("age","freq")
Exp2AgeT$age <- factor(Exp2AgeT$age, levels=c("18-29", "30-39", "40-49", "50-59", "+60"))
Fig2Exp2Age <- ggplot(Exp2Age, aes(x=age,color=age,fill=age))+theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp2AgeT, aes(x=age,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x="Age",y="Number of participants") + coord_cartesian(ylim=c(0, 32))

# Place
Exp2Place <- unique(dataExp2[,c("place","workerId")]);Exp2PlaceT <- as.data.frame(table(Exp2Place$place));names(Exp2PlaceT) <- c("place","freq")
place_levels <- c("north","south","overseas")
Exp2Place$place <- factor(Exp2Place$place, levels = place_levels)
Exp2PlaceT$place <- factor(Exp2PlaceT$place, levels = place_levels)
Fig2Exp2Place <- ggplot(Exp2Place, aes(x=place, color=place, fill= place)) + theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp2PlaceT,aes(x=place,y=freq,label=freq), color="black", vjust=-0.2,size=3) + labs(x = "Place", y = "Number of participants") + coord_cartesian(ylim=c(0, 60))

# Exposure to Māori
Exp2ME <- unique(dataExp2[,c("maoriExpo","workerId")]);Exp2ME$maoriExpo <- as.factor(Exp2ME$maoriExpo)
Exp2MET <- as.data.frame(table(Exp2ME$maoriExpo));names(Exp2MET) <- c("maoriExpo","freq")
Fig2Exp2ME <- ggplot(Exp2ME, aes(x=maoriExpo, color=maoriExpo, fill=maoriExpo))+theme_classic() + geom_bar(aes(),size=.1,show.legend=F) + geom_text(data=Exp2MET, aes(x=maoriExpo,y=freq,label=freq), color="black", vjust=-0.2,size=3)+labs(x="Level of exposure",y="Number of participants") + coord_cartesian(ylim=c(0, 21))

multiplot(Fig2Exp2Gender, Fig2Exp2Education, Fig2Exp2ML, Fig2Exp2Age, Fig2Exp2Place, Fig2Exp2ME, cols=2)
```

## Figure 6: Rate of accurate definitions per word
```{r fig.6, echo=FALSE, message=FALSE, warning=FALSE, evaluate=FALSE, fig.width=9, fig.height=6, fig.cap="Figure 6: Rate of accurate definitions per word. Words are displayed according to their phonotactic score on the x-axis and their accuracy rates are represented on the y-axis. Phonotactic score is shown on the x-axis. Overlapping labels are not shown."} 
# Type-based dictionary phonotactic score
Fig6 <- dataExp2[,c("workerId","word","correct","familiarity","scoreDictType")]
Fig6$correct1 <- 0;Fig6[Fig6$correct=="TRUE",]$correct1 <- 1;Fig6$correct1 <- as.numeric(Fig6$correct1)
accRate <- aggregate(Fig6$correct1, by=list(Fig6$word),  FUN=sum)
colnames(accRate) <- c("word","nbCorrect")
total <- length(unique(Fig6$workerId));accRate$rate <- accRate$nbCorrect/total
wordScore <- unique(Fig6[,c("word","familiarity","scoreDictType")])
accRate <- merge(accRate, wordScore, by="word")
ggplot(accRate, aes(x=scoreDictType, y=rate, label=word)) + labs(x= "Phonotactic score (DictType)", y="Accuracy rate") + theme_classic() + geom_point(aes(color="#F8766D"),size=2) + theme(legend.title=element_blank()) + geom_text(hjust=0.2,vjust=-0.7,check_overlap = TRUE, size=4) + theme(legend.position="none") + coord_cartesian(xlim=c(-0.5,-1.2)) 

# Token-based dictionary phonotactic score
Fig6 <- dataExp2[,c("workerId","word","correct","familiarity","scoreDictToken")]
Fig6$correct1 <- 0;Fig6[Fig6$correct=="TRUE",]$correct1 <- 1;Fig6$correct1 <- as.numeric(Fig6$correct1)
accRate <- aggregate(Fig6$correct1, by=list(Fig6$word),  FUN=sum)
colnames(accRate) <- c("word","nbCorrect")
total <- length(unique(Fig6$workerId));accRate$rate <- accRate$nbCorrect/total
wordScore <- unique(Fig6[,c("word","familiarity","scoreDictToken")])
accRate <- merge(accRate, wordScore, by="word")
ggplot(accRate, aes(x=scoreDictToken, y=rate, label=word)) + labs(x= "Phonotactic score (DictToken)", y="Accuracy rate") + theme_classic() + geom_point(aes(color="#F8766D"),size=2) + theme(legend.title=element_blank()) + geom_text(hjust=0.2,vjust=-0.7,check_overlap = TRUE, size=4) + theme(legend.position="none") 

# Running speech phonotactic score
Fig6 <- dataExp2[,c("workerId","word","correct","familiarity","scoreRsSeg")]
Fig6$correct1 <- 0;Fig6[Fig6$correct=="TRUE",]$correct1 <- 1;Fig6$correct1 <- as.numeric(Fig6$correct1)
accRate <- aggregate(Fig6$correct1, by=list(Fig6$word),  FUN=sum)
colnames(accRate) <- c("word","nbCorrect")
total <- length(unique(Fig6$workerId));accRate$rate <- accRate$nbCorrect/total
wordScore <- unique(Fig6[,c("word","familiarity","scoreRsSeg")])
accRate <- merge(accRate, wordScore, by="word")
ggplot(accRate, aes(x=scoreRsSeg, y=rate, label=word)) + labs(x= "Phonotactic score (scoreRsSeg)", y="Accuracy rate") + theme_classic() + geom_point(aes(color="#F8766D"),size=2) + theme(legend.title=element_blank()) + geom_text(hjust=0.2,vjust=-0.7,check_overlap = TRUE, size=4) + theme(legend.position="none") + coord_cartesian(xlim=c(-0.75,-1.6)) 
```

## Modeling accuracy with a generalized linear mixed effects model

[ST: "generalized linear mixed effects model" is a very general-purpose and vague term; I would suggest saying "mixed-effects binary logistic regression model" or something similar]

### Table 2: Participants’ basic knowledge of Māori with running speech phonotactics
```{r Table.2, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# Model for Table 2
# modelTable2 <- glmer(correct ~ c.(scoreRsSeg) + c.(familiarity) + c.(maoriList) + (1 + c.(scoreRsSeg) + c.(familiarity) |workerId) + (1+ c.(maoriList)|word), data=dataExp2, control=glmerControl(optimizer="bobyqa"), family=binomial(link="logit"))
# saveRDS(modelTable2, file = "modelTable2.rds")
modelTable2 <- readRDS("./modelTable2.rds")
logistic_table(modelTable2, caption="Table 2: Model summary for accuracy with a generalized linear mixed effects model. All numeric variables in this model are centered.")
``` 

### Figure 7: Effect plot from the model presented in Table 2

[ST: Do you also want to plot other effects from the model?]

```{r Fig.7, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=3.5,fig.align='center', fig.cap="Figure 7: Effect plot of phonotactic score on accuracy."}
Fig7 <- as.data.frame(effect(term="c.(scoreRsSeg)", mod=modelTable2, xlevels=list("scoreRsSeg"=25)))
ggplot(Fig7, aes(x=scoreRsSeg, y=fit)) + 
  geom_line(aes(color="#00BFC4")) + 
  geom_ribbon(aes(ymin=lower, ymax=upper, fill="#00BFC4"),alpha=0.1) + 
  labs(x= "Phonotactic score", y="Predicted accuracy") + 
  theme_classic() + 
  guides(fill=FALSE, color=FALSE)
```

### Table S5: Participants’ self-evaluated level of Māori proficiency with running speech phonotactics

[ST: The narrative reasons for these extra models is not clear to me, and it's a little confusing because they show effects that aren't in the other model (e.g. Fig. 8). Is this all explained in the paper?]

```{r Table.S5, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# Model for Table S5 (Māori proficiency)
# modelTableS5 <- glmer(correct ~ c.(scoreRsSeg) + c.(familiarity) + c.(maoriProf) + (1 + c.(scoreRsSeg) + c.(familiarity) |workerId) + (1+ c.(maoriProf)|word), data=dataExp2, control=glmerControl(optimizer="bobyqa"), family=binomial(link="logit"))
# saveRDS(modelTableS5, file = "modelTableS5.rds")
modelTableS5 <- readRDS("./modelTableS5.rds")   
logistic_table(modelTableS5, caption="Table S5 (Māori proficiency): Modeling summary for accuracy with a generalized linear mixed effects model. All numeric variables in this model are centered.")
``` 

### Table S6: Participants’ self-reported level of exposure to Māori with running speech phonotactics
```{r Table.S6, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# Model for Table S6 (Exposure to Māori)
# modelTableS6 <- glmer(correct ~ c.(scoreRsSeg) + c.(familiarity) + c.(maoriExpo) + (1 + c.(scoreRsSeg) + c.(familiarity) |workerId) + (1+ c.(maoriExpo)|word), data=dataExp2, control=glmerControl(optimizer="bobyqa"), family=binomial(link="logit")) 
# saveRDS(modelTableS6, file = "modelTableS6.rds")
modelTableS6 <- readRDS("./modelTableS6.rds")   
logistic_table(modelTableS6, caption="Table S6 (Exposure to Māori): Modeling summary for accuracy with a generalized linear mixed effects model. All numeric variables in this model are centered.")
``` 

### Table S7: Participants’ basic knowledge of Māori with token-based phonotactics
```{r Table.S7, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
# Model for Figure 8
# modelFigure8 <- glmer(correct ~ c.(scoreDictToken) + c.(n.neighbors) + c.(familiarity) + c.(maoriList) + (1 + c.(scoreDictToken) + c.(familiarity)|workerId) + (0 + c.(n.neighbors)|workerId) + (1 + c.(maoriList)|word), data=dataExp2, control=glmerControl(optimizer="bobyqa"), family=binomial(link="logit"))
# saveRDS(modelFigure8, file = "modelFigure8.rds")
modelFigure8 <- readRDS("./modelFigure8.rds")
logistic_table(modelFigure8, caption="Table S7: Model summary for accuracy with a generalized linear mixed effects model. All numeric variables in this model are centered.")
``` 

### Figure 8: Effect plot from the model presented in Table S7
```{r Fig.8, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=3.5,fig.align='center', fig.cap="Figure 8: Effect plot of neighbourhood density on accuracy."}
Fig8 <- as.data.frame(effect(term="c.(n.neighbors)", mod=modelFigure8, xlevels=list("n.neighbors"=25)))
ggplot(Fig8, aes(x=n.neighbors, y=fit)) + 
  geom_line(aes(color="#00BFC4")) + 
  geom_ribbon(aes(ymin=lower, ymax=upper, fill="#00BFC4"),alpha=0.1) + 
  labs(x= "Neighbourhood density", y="Predicted accuracy") + 
  theme_classic() + 
  guides(fill=FALSE, color=FALSE)
```

# Supporting Information
## Appendix A: Post-questionnaire
1.	How well are you able to speak Māori?    
$\square$ Very well (I can talk about almost anything in Māori)    
$\square$ Well (I can talk about many things in Māori)  
$\square$ Fairly well (I can talk about some things in Māori)  
$\square$ Not very well (I can only talk about simple/basic things in Māori)  
$\square$ No more than a few words or phrases  
$\square$ Not at all  
   
2. How well are you able to understand/read Māori?  
$\square$ Very well (I can understand almost anything said/written in Māori)  
$\square$ Well (I can understand many things said/written in Māori)  
$\square$ Fairly well (I can understand some things said/written in Māori  
$\square$ Not very well (I can only understand simple/basic things said/written in Māori)  
$\square$ No more than a few words or phrases  
$\square$ Not at all  
   
3. Which age group do you belong to?  
$\square$ 18 - 29  
$\square$ 30 - 39  
$\square$ 40 - 49  
$\square$ 50 - 59  
$\square$ +60  
   
4. Please state your gender:  
   
5. Please state your ethnicity:  
   
6. Your highest education is:  
$\square$ High school  
$\square$ Undergraduate degree  
$\square$ Graduate degree  
   
7. How often do you think you are exposed to the Māori language in your daily life, by means of Māori radio, Māori TV, online media?  
$\square$ Less than once a year  
$\square$ Less than once a month  
$\square$ Less than once a week  
$\square$ Less than once a day  
$\square$ Multiple times a day  
   
8. How often do you think you are exposed to Māori language in your daily life, in conversation at work, at home, in social settings?  
$\square$ Less than once a year  
$\square$ Less than once a month  
$\square$ Less than once a week  
$\square$ Less than once a day  
$\square$ Multiple times a day  
   
9. In the past five years, have you had any children living with you who have attended preschool or primary school in New Zealand?  
$\square$ Yes  
$\square$ No  
   
10. Please tick all boxes that apply.  
$\square$ I can give a mihi in Māori.  
$\square$ I can sing a few songs in Māori.  
$\square$ I can sing the NZ national anthem in Māori.  
$\square$ I know how to say some basic phrases (e.g. My name is..., I'm from...) in Māori.  
$\square$ I know how to say some commands (e.g. Sit down / Come here) in Māori.  
$\square$ I know how to say some greetings in Māori.  
$\square$ I know how to say some numbers in Māori.  
$\square$ I know how to say some body parts in Māori.  
$\square$ I know how to say some colors in Māori.  
   
11. What region of New Zealand do you live in currently? (Please choose ``overseas" if you are living outside of New Zealand.)  
$\square$ Northland  
$\square$ Auckland  
$\square$ Waikato  
$\square$ Bay of Plenty  
$\square$ Gisborne  
$\square$ Hawke's Bay  
$\square$ Taranaki  
$\square$ Wanganui  
$\square$ Manawatu  
$\square$ Wairarapa  
$\square$ Wellington  
$\square$ Nelson Bays  
$\square$ Marlborough  
$\square$ West Coast  
$\square$ Canterbury  
$\square$ Timaru - Oamaru  
$\square$ Otago  
$\square$ Southland  
$\square$ Overseas  
   
12. How long have you been living there?  
   
13. Please state your first language (the language you speak/use most of your time).  
   
14. What country were you living in when you first learned this language?  
   
15. Please list any other languages that you can speak fluently:  
   
16. Have you ever lived in Hawaii?  
$\square$ Yes  
$\square$ No    
   
17. Do you speak/understand any Polynesian languages such as Hawaiian, Tahitian, Sāmoan, or Tongan?  
$\square$ Yes  
$\square$ No  
   
18. If you replied yes to question 17, please state the language you know.  
   
19. Do you have a history of any speech or language impairments that you are aware of?  
$\square$ Yes
$\square$ No  
  
## Appendix B: Stimulus materials for Experiments
### List of stimuli for Experiment 1 - real words
```{r Table.ApB1, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
dataExp1 %>%
  filter(type == "real") %>%
  arrange(word) %>%
  pull(word) %>%
  unique() %>%
  paste(., collapse = ", ") %>%
  kable(caption="Table 4: List of stimuli for Experiment 1 - real words", col.names = NULL) %>%
  kable_styling()
``` 

### List of stimuli for Experiment 1 - nonwords
```{r Table.ApB2, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
dataExp1 %>%
  filter(type == "non") %>%
  arrange(word) %>%
  pull(word) %>%
  unique() %>%
  paste(., collapse = ", ") %>%
  kable(caption="Table 4: List of stimuli for Experiment 1 - nonwords", col.names = NULL) %>%
  kable_styling()
``` 

### List of stimuli for Experiment 2
```{r Table.ApB3, echo=TRUE, message=FALSE, warning=FALSE, eval=TRUE}
dataExp2 %>%
  arrange(word) %>%
  pull(word) %>%
  unique() %>%
  paste(., collapse = ", ") %>%
  kable(caption="Table 6: List of stimuli for Experiment 2", col.names = NULL) %>%
  kable_styling()
``` 

